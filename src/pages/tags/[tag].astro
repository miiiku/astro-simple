---
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const tags = [...new Set(posts.map(post => post.data.tags || []).flat())];
  return tags.map((tag) => {
    return {
      params: { tag },
      props: {
        posts: posts.filter((post) => post.data.tags?.includes(tag)),
      },
    }
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title={`tag:${tag}`}>
  <p>Posts tagged with <strong>{tag}</strong></p>

  <ul>
    {posts.map((post) => <li><a href={`/blog/${post.slug}`}>{post.data.title}</a></li>)}
  </ul>
</BaseLayout>